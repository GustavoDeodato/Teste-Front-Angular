<div class="page">
  <div class="header">
    <button class="btn-back-icon" (click)="goBack()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
    </button>
  </div>

  @if (loading) {
    <div class="loading">Carregando...</div>
  }

  @if (!loading) {
    <div class="content-wrapper">
      <header class="form-header">
        <h1>{{ isEditMode ? 'Editar Item' : 'Novo Item' }}</h1>
        <p class="subtitle">Adicione um novo item ao inventário ou atualize suas informações</p>
      </header>

      <form (ngSubmit)="onSubmit()" class="two-column-layout">
        
        <div class="main-form-column">
          
          <section class="form-card">
            <div class="card-header">
              <h3>Informações Básicas</h3>
              <p>Dados principais do item</p>
            </div>
            
            <div class="input-row">
              <div class="form-group flex-2">
                <label>Nome *</label>
                <input type="text" [(ngModel)]="formData.nome" name="nome" placeholder="Nome do item" [class.error]="errors.nome">
                @if (errors.nome) { <span class="error-msg">{{errors.nome}}</span> }
              </div>
              <div class="form-group flex-1">
                <label>SKU / Código</label>
                <input type="text" [(ngModel)]="formData.sku" name="sku" placeholder="Código único do item">
              </div>
            </div>
          </section>

          <section class="form-card">
            <div class="card-header">
              <h3>Classificação</h3>
              <p>Categoria e localização do item</p>
            </div>
            <div class="input-row">
              <div class="form-group">
                <label>Categoria *</label>
                <select [(ngModel)]="formData.categoriaId" name="categoriaId" [class.error]="errors.categoriaId">
                  <option [value]="0">Selecione uma categoria</option>
                  @for (cat of categories; track cat.id) {
                    <option [value]="cat.id">{{cat.nome}}</option>
                  }
                </select>
              </div>
              <div class="form-group">
                <label>Localização</label>
                <input type="text" [(ngModel)]="formData.localizacao" name="localizacao" placeholder="Digite a localização">
              </div>
            </div>
          </section>

          <section class="form-card">
            <div class="card-header">
              <h3>Estoque e Preço</h3>
              <p>Quantidade e valores</p>
            </div>
            <div class="input-row three-cols">
              <div class="form-group">
                <label>Quantidade *</label>
                <input type="number" [(ngModel)]="formData.quantidade" name="quantidade" placeholder="0">
              </div>
              <div class="form-group">
                <label>Estoque Mínimo *</label>
                <input type="number" [(ngModel)]="formData.estoqueMinimo" name="estoqueMinimo" placeholder="0">
              </div>
              <div class="form-group">
                <label>Preço Unitário *</label>
                <input type="number" [(ngModel)]="formData.preco" name="preco" placeholder="0.00" step="0.01">
              </div>
            </div>
          </section>
        </div>

        <div class="side-form-column">
          
          <section class="form-card">
            <h3>Status</h3>
            <div class="form-group">
              <select [(ngModel)]="formData.status" name="status">
                <option value="Ativo">Ativo</option>
                <option value="Inativo">Inativo</option>
              </select>
            </div>
          </section>

          <div class="sticky-actions">
            <button type="submit" class="btn-primary-full" [disabled]="submitting">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                <polyline points="17 21 17 13 7 13 7 21"/>
                <polyline points="7 3 7 8 15 8"/>
              </svg>
              {{ submitting ? 'Salvando...' : (isEditMode ? 'Atualizar Item' : 'Criar Item') }}
            </button>
            <button type="button" class="btn-secondary-full" (click)="goBack()">
              Cancelar
            </button>
          </div>
        </div>

      </form>
    </div>
  }
</div>